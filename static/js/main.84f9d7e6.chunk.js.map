{"version":3,"sources":["App.module.css","ElevationChart.module.css","RouteMap.module.css","webpack:///./src/constants.ts?85ee","data/routes.ts","SegmentRepository.ts","util/simplify.ts","ElevationChart.tsx","util.ts","worldConfig.ts","RouteMap.tsx","RouteSelector.tsx","App.tsx","hooks/useHash.ts","index.tsx","RouteSelector.module.css"],"names":["module","exports","WORLDS","routes","segmentCache","getSegment","segmentSlug","a","fetchSegment","fetch","response","json","getSqDist","p1","p2","dx","x","dy","y","getSqSegDist","p","t","simplifyRadialDist","points","sqTolerance","point","prevPoint","newPoints","i","len","length","push","simplifyDPStep","first","last","simplified","index","maxSqDist","sqDist","simplifyDouglasPeucker","simplify","tolerance","highestQuality","ElevationChart","route","segment","useAsync","slug","result","data","useMemo","undefined","id","distance","map","altitude","className","styles","Container","margin","top","right","bottom","left","xScale","type","min","max","yScale","axisTop","axisRight","axisBottom","orient","tickSize","tickPadding","format","value","axisLeft","tickValues","pointSize","useMesh","enableSlices","animate","enableGridX","sliceTooltip","slice","style","background","padding","border","Math","round","flipLatLng","worldConfigs","process","bounds","france","innsbruck","london","paris","richmond","watopia","yorkshire","mapboxgl","workerClass","mapboxWorker","Mapbox","ReactMapboxGl","accessToken","dragRotate","pitchWithRotate","touchZoomRotate","minZoom","maxZoom","LINE_PAINT","RouteMap","routeSelection","mouseHoverDistance","world","worldConfig","useState","setMap","r","useEffect","coordinates","latlng","reduce","coord","extend","LngLatBounds","resize","fitBounds","setZoom","lineGeoJSON","lineString","pointGeoJSON","along","units","maxBounds","onStyleLoad","linePaint","circlePaint","RouteSelector","selection","onChange","handleChange","e","target","checked","find","filteredRoutes","filter","sport","stravaSegmentId","sort","b","name","localeCompare","Sidebar","c","Item","selected","App","window","location","hash","setHash","listener","addEventListener","removeEventListener","useHash","includes","setMouseHoverDistance","Wrapper","routeSelected","rs","onMouseHoverDistanceChange","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.84f9d7e6.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"Wrapper\":\"App_Wrapper__2FdRQ\",\"routeSelected\":\"App_routeSelected__V3XxY\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Container\":\"ElevationChart_Container__3f2Iq\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Container\":\"RouteMap_Container__15uh3\",\"navigationControl\":\"RouteMap_navigationControl__1ZKIj\"};","import { World } from \"./types\";\n\nexport const MAPBOX_TOKEN = process.env.REACT_APP_MAPBOX_TOKEN!;\n\nexport const WORLDS: World[] = [\n  \"crit-city\",\n  \"france\",\n  \"innsbruck\",\n  \"london\",\n  \"new-york\",\n  \"paris\",\n  \"richmond\",\n  \"watopia\",\n  \"yorkshire\",\n];\n","import { Route } from \"../types\";\nimport routesJSON from \"./routes.json\";\n\nexport const routes: Route[] = routesJSON as any;\n","import { Segment } from \"./types\";\n\nconst segmentCache: { [segmentSlug: string]: Promise<Segment> } = {};\n\nexport async function getSegment(segmentSlug: string): Promise<Segment> {\n  if (!segmentCache[segmentSlug]) {\n    segmentCache[segmentSlug] = fetchSegment(segmentSlug);\n  }\n\n  return await segmentCache[segmentSlug];\n}\n\nasync function fetchSegment(segmentSlug: string) {\n  const response = await fetch(`segments/${segmentSlug}.json`);\n  return await response.json();\n}\n","// @see: https://github.com/mourner/simplify-js\n\ninterface Point {\n  x: number;\n  y: number;\n}\n\nfunction getSqDist(p1: Point, p2: Point) {\n  const dx = p1.x - p2.x;\n  const dy = p1.y - p2.y;\n\n  return dx * dx + dy * dy;\n}\n\n// square distance from a point to a segment\nfunction getSqSegDist(p: Point, p1: Point, p2: Point) {\n  let x = p1.x;\n  let y = p1.y;\n  let dx = p2.x - x;\n  let dy = p2.y - y;\n\n  if (dx !== 0 || dy !== 0) {\n    const t = ((p.x - x) * dx + (p.y - y) * dy) / (dx * dx + dy * dy);\n\n    if (t > 1) {\n      x = p2.x;\n      y = p2.y;\n    } else if (t > 0) {\n      x += dx * t;\n      y += dy * t;\n    }\n  }\n\n  dx = p.x - x;\n  dy = p.y - y;\n\n  return dx * dx + dy * dy;\n}\n// rest of the code doesn't care about point format\n\n// basic distance-based simplification\nfunction simplifyRadialDist(points: Point[], sqTolerance: number) {\n  let prevPoint = points[0];\n  const newPoints = [prevPoint];\n\n  let point: Point | undefined;\n  for (let i = 1, len = points.length; i < len; ++i) {\n    point = points[i];\n\n    if (getSqDist(point, prevPoint) > sqTolerance) {\n      newPoints.push(point);\n      prevPoint = point;\n    }\n  }\n\n  if (prevPoint !== point) {\n    newPoints.push(point!);\n  }\n\n  return newPoints;\n}\n\nfunction simplifyDPStep(\n  points: Point[],\n  first: number,\n  last: number,\n  sqTolerance: number,\n  simplified: Point[]\n) {\n  let maxSqDist = sqTolerance;\n\n  let index: number | undefined;\n  for (let i = first + 1; i < last; ++i) {\n    const sqDist = getSqSegDist(points[i], points[first], points[last]);\n\n    if (sqDist > maxSqDist) {\n      index = i;\n      maxSqDist = sqDist;\n    }\n  }\n\n  if (maxSqDist > sqTolerance) {\n    if (index! - first > 1) {\n      simplifyDPStep(points, first, index!, sqTolerance, simplified);\n    }\n    simplified.push(points[index!]);\n    if (last - index! > 1) {\n      simplifyDPStep(points, index!, last, sqTolerance, simplified);\n    }\n  }\n}\n\n// simplification using Ramer-Douglas-Peucker algorithm\nfunction simplifyDouglasPeucker(points: Point[], sqTolerance: number) {\n  const last = points.length - 1;\n\n  const simplified = [points[0]];\n  simplifyDPStep(points, 0, last, sqTolerance, simplified);\n  simplified.push(points[last]);\n\n  return simplified;\n}\n\n// both algorithms combined for awesome performance\nexport function simplify(\n  points: Point[],\n  tolerance = 1,\n  highestQuality = false\n) {\n  if (points.length <= 2) {\n    return points;\n  }\n\n  const sqTolerance = tolerance * tolerance;\n\n  points = highestQuality ? points : simplifyRadialDist(points, sqTolerance);\n  points = simplifyDouglasPeucker(points, sqTolerance);\n\n  return points;\n}\n","import { ResponsiveLine, Serie } from \"@nivo/line\";\nimport React, { useMemo } from \"react\";\nimport { useAsync } from \"react-async-hook\";\nimport styles from \"./ElevationChart.module.css\";\nimport { getSegment } from \"./SegmentRepository\";\nimport { Route } from \"./types\";\nimport { simplify } from \"./util/simplify\";\n\ninterface Props {\n  route: Route;\n  onMouseHoverDistanceChange: (distance: number | undefined) => void;\n}\n\nexport function ElevationChart({ route }: Props) {\n  const { result: segment } = useAsync(getSegment, [route.slug]);\n\n  const data: Serie[] | undefined = useMemo(() => {\n    if (segment === undefined) {\n      return;\n    }\n\n    const serie = {\n      id: \"Elevation\",\n      data: simplify(\n        segment.distance.map((distance, index) => ({\n          x: distance,\n          y: segment.altitude[index],\n        })),\n        0.25\n      ),\n    };\n\n    return [serie];\n  }, [segment]);\n\n  if (data === undefined) {\n    return null;\n  }\n\n  return (\n    <div className={styles.Container}>\n      <ResponsiveLine\n        data={data}\n        margin={{ top: 25, right: 25, bottom: 50, left: 50 }}\n        xScale={{ type: \"linear\", min: \"auto\", max: \"auto\" }}\n        yScale={{ type: \"linear\", min: \"auto\", max: \"auto\" }}\n        axisTop={null}\n        axisRight={null}\n        axisBottom={{\n          orient: \"bottom\",\n          tickSize: 5,\n          tickPadding: 5,\n          format: (value) => `${(value as number) / 1_000} km`,\n        }}\n        axisLeft={{\n          orient: \"left\",\n          tickSize: 5,\n          tickPadding: 5,\n          tickValues: 5,\n          format: (value) => `${value} m`,\n        }}\n        pointSize={0}\n        useMesh={true}\n        enableSlices=\"x\"\n        animate={false}\n        enableGridX={false}\n        sliceTooltip={({ slice }) => (\n          <table\n            style={{\n              background: \"white\",\n              padding: \"9px 12px\",\n              border: \"1px solid #ccc\",\n            }}\n          >\n            <tbody>\n              <tr>\n                <td>Distance:</td>\n                <td>\n                  <strong>\n                    {Math.round((slice.points[0].data.x as number) / 1_000)} km\n                  </strong>\n                </td>\n              </tr>\n              <tr>\n                <td>Elevation:</td>\n                <td>\n                  <strong>\n                    {Math.round(slice.points[0].data.y as number)} m\n                  </strong>\n                </td>\n              </tr>\n            </tbody>\n          </table>\n        )}\n      />\n    </div>\n  );\n}\n","export function flipLatLng(p: [number, number]): [number, number] {\n  return [p[1], p[0]];\n}\n","import type { FitBounds } from \"react-mapbox-gl/lib/map\";\nimport { World } from \"./types\";\n\nexport type WorldConfig = {\n  style: string;\n  bounds: FitBounds;\n};\n\nexport const worldConfigs: Record<World, WorldConfig> = {\n  \"crit-city\": {\n    style: process.env.REACT_APP_MAPBOX_STYLE_CRIT_CITY!,\n    bounds: [\n      [165.78, -10.4],\n      [165.82, -10.37],\n    ],\n  },\n\n  france: {\n    style: process.env.REACT_APP_MAPBOX_STYLE_FRANCE!,\n    bounds: [\n      [166.14, -21.76],\n      [166.26, -21.64],\n    ],\n  },\n\n  innsbruck: {\n    style: process.env.REACT_APP_MAPBOX_STYLE_INNSBRUCK!,\n    bounds: [\n      [11.35, 47.21],\n      [11.48, 47.29],\n    ],\n  },\n\n  london: {\n    style: process.env.REACT_APP_MAPBOX_STYLE_LONDON!,\n    bounds: [\n      [-0.17, 51.46],\n      [-0.06, 51.53],\n    ],\n  },\n\n  \"new-york\": {\n    style: process.env.REACT_APP_MAPBOX_STYLE_NEW_YORK!,\n    bounds: [\n      [-74.02, 40.74],\n      [-73.92, 40.82],\n    ],\n  },\n\n  paris: {\n    style: process.env.REACT_APP_MAPBOX_STYLE_PARIS!,\n    bounds: [\n      [2.25, 48.83],\n      [2.37, 48.91],\n    ],\n  },\n\n  richmond: {\n    style: process.env.REACT_APP_MAPBOX_STYLE_RICHMOND!,\n    bounds: [\n      [-77.49, 37.5],\n      [-77.39, 37.58],\n    ],\n  },\n\n  watopia: {\n    style: process.env.REACT_APP_MAPBOX_STYLE_WATOPIA!,\n    bounds: [\n      [166.88, -11.7],\n      [167.03, -11.63],\n    ],\n  },\n  yorkshire: {\n    style: process.env.REACT_APP_MAPBOX_STYLE_YORKSHIRE!,\n    bounds: [\n      [-1.63, 53.95],\n      [-1.5, 54.03],\n    ],\n  },\n};\n","import along from \"@turf/along\";\nimport { lineString } from \"@turf/helpers\";\nimport mapboxgl, { LinePaint, LngLatBounds, Map } from \"mapbox-gl\";\nimport React, { useEffect, useMemo, useState } from \"react\";\nimport { useAsync } from \"react-async-hook\";\nimport ReactMapboxGl, {\n  GeoJSONLayer,\n  ScaleControl,\n  ZoomControl\n} from \"react-mapbox-gl\";\n// @ts-ignore\n// eslint-disable-next-line import/no-webpack-loader-syntax\nimport mapboxWorker from \"worker-loader!mapbox-gl/dist/mapbox-gl-csp-worker\";\nimport { MAPBOX_TOKEN } from \"./constants\";\nimport styles from \"./RouteMap.module.css\";\nimport { RouteSelection } from \"./RouteSelector\";\nimport { getSegment } from \"./SegmentRepository\";\nimport { Route } from \"./types\";\nimport { flipLatLng } from \"./util\";\nimport { worldConfigs } from \"./worldConfig\";\n\n// @ts-ignore\nmapboxgl.workerClass = mapboxWorker;\n\nconst Mapbox = ReactMapboxGl({\n  accessToken: MAPBOX_TOKEN,\n  dragRotate: false,\n  pitchWithRotate: false,\n  touchZoomRotate: false,\n  minZoom: 0, // limited by max bounds\n  maxZoom: 18,\n});\n\nconst LINE_PAINT: LinePaint = {\n  \"line-color\": \"#fc6719\",\n  \"line-width\": 4,\n};\n\ninterface Props {\n  routeSelection: RouteSelection;\n  mouseHoverDistance: number | undefined;\n}\n\nexport default function RouteMap({\n  routeSelection,\n  mouseHoverDistance,\n}: Props) {\n  const world = routeSelection.world;\n  const worldConfig = worldConfigs[world];\n  const [map, setMap] = useState<Map | undefined>(undefined);\n\n  const { result: segment } = useAsync(\n    async (r?: Route) => {\n      if (r === undefined) {\n        return;\n      }\n\n      return await getSegment(r.slug);\n    },\n    [routeSelection.route]\n  );\n\n  useEffect(() => {\n    if (!map || !segment) {\n      return;\n    }\n\n    const coordinates: [number, number][] = segment.latlng.map(flipLatLng);\n    const bounds = coordinates.reduce(\n      (bounds, coord) => bounds.extend(coord),\n      new LngLatBounds(coordinates[0], coordinates[0])\n    );\n\n    map.resize().fitBounds(bounds, {\n      padding: 20,\n    });\n  }, [map, segment]);\n\n  useEffect(() => {\n    if (!map || routeSelection.route) {\n      return;\n    }\n\n    // zoom out if map changed without selected route\n    map.resize().setZoom(0);\n  }, [map, routeSelection]);\n\n  const lineGeoJSON = useMemo(() => {\n    if (!segment) {\n      return;\n    }\n    return lineString(segment.latlng.map(flipLatLng));\n  }, [segment]);\n\n  const pointGeoJSON = useMemo(() => {\n    if (!lineGeoJSON || !mouseHoverDistance) {\n      return;\n    }\n\n    return along(lineGeoJSON, mouseHoverDistance, { units: \"kilometers\" });\n  }, [lineGeoJSON, mouseHoverDistance]);\n\n  return (\n    <Mapbox\n      // eslint-disable-next-line react/style-prop-object\n      style={worldConfig.style}\n      className={styles.Container}\n      maxBounds={worldConfig.bounds}\n      onStyleLoad={(map) => setMap(map)}\n    >\n      <ZoomControl />\n      <ScaleControl />\n      {lineGeoJSON && (\n        <GeoJSONLayer data={lineGeoJSON} linePaint={LINE_PAINT} />\n      )}\n      {pointGeoJSON && (\n        <GeoJSONLayer\n          data={pointGeoJSON}\n          circlePaint={{\n            \"circle-radius\": 7.5,\n            \"circle-color\": \"white\",\n            \"circle-stroke-width\": 1,\n          }}\n        />\n      )}\n    </Mapbox>\n  );\n}\n","import c from \"classnames\";\nimport { ChangeEvent } from \"react\";\nimport { routes } from \"./data/routes\";\nimport styles from \"./RouteSelector.module.css\";\nimport { Route, World } from \"./types\";\n\nexport interface RouteSelection {\n  world: World;\n  route?: Route;\n}\n\ninterface Props {\n  selection: RouteSelection;\n  onChange: (route: RouteSelection) => void;\n}\nexport default function RouteSelector({ selection, onChange }: Props) {\n  const handleChange = (e: ChangeEvent<HTMLInputElement>) => {\n    if (e.target.checked) {\n      const route = routes.find((r) => r.slug === e.target.value)!;\n      onChange({ world: route.world, route });\n    }\n  };\n\n  const filteredRoutes = routes\n    .filter((route) => route.world === selection.world)\n    .filter((route) => route.sport === \"cycling\")\n    .filter((route) => route.stravaSegmentId !== undefined)\n    .sort((a, b) => a.name.localeCompare(b.name));\n\n  return (\n    <div className={styles.Container}>\n      <div className={styles.Sidebar}>\n        <select\n          value={selection.world}\n          onChange={(e) => onChange({ world: e.target.value as World })}\n        >\n          <option value=\"crit-city\">Crit City</option>\n          <option value=\"france\">France</option>\n          <option value=\"innsbruck\">Innsbruck</option>\n          <option value=\"london\">London</option>\n          <option value=\"new-york\">New York</option>\n          <option value=\"paris\">Paris</option>\n          <option value=\"richmond\">Richmond</option>\n          <option value=\"watopia\">Watopia</option>\n          <option value=\"yorkshire\">Yorkshire</option>\n        </select>\n\n        {filteredRoutes.map((route) => (\n          <label\n            key={route.slug}\n            className={c(styles.Item, {\n              [styles.selected]: selection.route?.slug === route.slug,\n            })}\n          >\n            <input\n              type=\"radio\"\n              name=\"routes\"\n              value={route.slug}\n              checked={selection.route?.slug === route.slug}\n              onChange={handleChange}\n            />\n            {route.name}\n          </label>\n        ))}\n      </div>\n    </div>\n  );\n}\n","import c from \"classnames\";\nimport React, { useMemo, useState } from \"react\";\nimport styles from \"./App.module.css\";\nimport { WORLDS } from \"./constants\";\nimport { routes } from \"./data/routes\";\nimport { ElevationChart } from \"./ElevationChart\";\nimport { useHash } from \"./hooks/useHash\";\nimport RouteMap from \"./RouteMap\";\nimport RouteSelector, { RouteSelection } from \"./RouteSelector\";\nimport { World } from \"./types\";\n\nexport default function App() {\n  const [hash, setHash] = useHash();\n  const routeSelection = useMemo<RouteSelection>(() => {\n    if (WORLDS.includes(hash as any)) {\n      return { world: hash as World };\n    } else if (routes.find((r) => r.slug === hash)) {\n      const route = routes.find((r) => r.slug === hash)!;\n      return {\n        world: route.world,\n        route,\n      };\n    }\n\n    return { world: \"watopia\" as World };\n  }, [hash]);\n\n  const handleRouteSelectionChange = (rs: RouteSelection) => {\n    if (rs.route) {\n      setHash(rs.route.slug);\n    } else {\n      setHash(rs.world);\n    }\n  };\n\n  const [mouseHoverDistance, setMouseHoverDistance] = useState<\n    number | undefined\n  >(undefined);\n\n  return (\n    <div\n      className={c(styles.Wrapper, {\n        [styles.routeSelected]: routeSelection.route !== undefined,\n      })}\n    >\n      <RouteSelector\n        selection={routeSelection}\n        onChange={handleRouteSelectionChange}\n      />\n      <RouteMap\n        routeSelection={routeSelection}\n        mouseHoverDistance={mouseHoverDistance}\n      />\n      {routeSelection.route && (\n        <ElevationChart\n          route={routeSelection.route}\n          onMouseHoverDistanceChange={setMouseHoverDistance}\n        />\n      )}\n    </div>\n  );\n}\n","import { useEffect, useState } from \"react\";\n\nexport function useHash(): [string, (hash: string) => void] {\n  const [hash, setHash] = useState(window.location.hash);\n\n  useEffect(() => {\n    const listener = () => {\n      setHash(window.location.hash);\n    };\n\n    window.addEventListener(\"popstate\", listener);\n    return () => window.removeEventListener(\"popstate\", listener);\n  }, []);\n\n  const updateHash = (hash: string) => {\n    window.location.hash = `#${hash}`;\n  };\n\n  return [hash.slice(1), updateHash];\n}\n","import \"mapbox-gl/dist/mapbox-gl.css\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport \"./index.css\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"app\")\n);\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Container\":\"RouteSelector_Container__2aeQm\",\"Sidebar\":\"RouteSelector_Sidebar__25tGa\",\"Item\":\"RouteSelector_Item__402nz\",\"selected\":\"RouteSelector_selected__2JMs6\"};"],"sourceRoot":""}