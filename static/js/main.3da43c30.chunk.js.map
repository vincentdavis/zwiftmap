{"version":3,"sources":["App.module.css","data/index.ts","hooks/useLocationState.ts","hooks/useSettings.ts","services/search.ts","components/SettingsDialog/index.tsx","StravaSegmentRepository.ts","components/ElevationGradient/index.tsx","components/ElevationChartPreview/index.tsx","components/Sidebar/SearchResultCardRoute.tsx","hooks/useOnScreen.tsx","components/Sidebar/SearchResultCardWorld.tsx","components/Sidebar/SearchResultList.tsx","components/Sidebar/index.tsx","worldConfig.ts","maps/crit-city.png","maps/france.png","maps/innsbruck.png","maps/london.png","maps/new-york.png","maps/paris.png","maps/richmond.png","maps/watopia.png","maps/yorkshire.png","RouteMap.tsx","App.tsx","index.tsx","components/Sidebar/index.module.css"],"names":["module","exports","routes","routesJSON","segments","segmentsJSON","worlds","worldsJSON","DEFAULT_WORLD","find","w","slug","listeners","useLocationState","useState","getLocationState","state","setState","useEffect","listener","window","addEventListener","removeEventListener","newState","push","splice","indexOf","useCallback","searchParams","URLSearchParams","set","world","route","history","pushState","undefined","toString","forEach","l","location","search","get","filter","r","LOCAL_STORAGE_KEY","loadSettings","rawSettings","localStorage","getItem","sport","JSON","parse","useSettings","settings","setSettings","newSettings","setItem","stringify","saveSettings","searchResults","map","type","terms","name","t","toLocaleLowerCase","data","stravaSegmentId","searchResultTypes","title","segment","SettingsDialog","visible","onClose","handleSportChange","e","target","checked","value","Dialog","id","aria-labelledby","onRequestClose","DialogHeader","DialogTitle","DialogContent","Fieldset","legend","Radio","label","onChange","DialogFooter","Button","onClick","cache","getStravaSegmentStream","segmentSlug","stream","a","cacheKey","fetchStravaSegmentStream","getStravaSegmentStreams","streams","Promise","all","streamData","Object","fromEntries","i","fetch","response","json","ElevationGradient","x1","y1","x2","y2","offset","stopColor","stopOpacity","REQUIRED_STREAMS","ElevationChartPreview","useAsync","result","useMemo","filteredData","uniqWith","distance","index","Math","round","elevation","altitude","b","lowestElevation","min","d","AreaChart","height","width","baseValue","XAxis","dataKey","domain","unit","hide","YAxis","allowDecimals","Area","stroke","fillOpacity","fill","isAnimationActive","CircularProgress","small","circleStyle","SearchResultCardRoute","ListItem","secondaryText","getRouteInfo","rightAddonType","rightAddon","ChartContainer","ref","useRef","onScreen","isIntersecting","setIntersecting","current","observer","IntersectionObserver","entry","observe","unobserve","useOnScreen","style","pointerEvents","SearchResultCardWorld","length","s","SearchResultList","onResultClick","searchResult","Divider","ListSubheader","SearchResultCard","Sidebar","locationState","setLocationState","query","setQuery","settingsDialogVisible","setSettingsDialogVisible","term","split","sr","every","some","srt","includes","className","styles","Container","List","SearchBox","SimpleListItem","TextField","placeholder","isRightAddon","rightChildren","buttonType","right","position","aria-label","FontIcon","NoGapDivider","sort","localeCompare","BottomMenu","worldConfigs","imageBounds","initialBounds","image","backgroundColor","france","innsbruck","london","paris","richmond","watopia","yorkshire","RouteMap","mouseHoverDistance","worldConfig","filteredSegments","stravaSegmentsInWorld","fs","stravaSegments","stravaData","setMap","zoomControl","setPosition","routeStravaSegment","bounds","latlng","reduce","coord","extend","LatLngBounds","invalidateSize","fitBounds","setMaxBounds","minZoom","getBoundsZoom","setMinZoom","pointCoordinates","pointIndex","findIndex","MapContainer","whenCreated","maxZoom","ImageOverlay","url","attribution","Pane","Polyline","positions","pathOptions","color","weight","LayersControl","Overlay","LayerGroup","Circle","center","radius","fillColor","ScaleControl","App","Wrapper","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.3da43c30.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"Wrapper\":\"App_Wrapper__2FdRQ\"};","import { Route, Segment, World } from \"../types\";\nimport routesJSON from \"./routes.json\";\nimport segmentsJSON from \"./segments.json\";\nimport worldsJSON from \"./worlds.json\";\n\nexport const routes: Route[] = routesJSON as any;\nexport const segments: Segment[] = segmentsJSON as any;\nexport const worlds: World[] = worldsJSON as any;\n\n","import { useCallback, useEffect, useState } from \"react\";\nimport { routes, worlds } from \"../data\";\nimport { LocationState } from \"../types\";\n\nconst DEFAULT_WORLD = worlds.find((w) => w.slug === \"watopia\")!;\n\ntype Listener = (state: LocationState) => void;\nconst listeners: Listener[] = [];\n\nexport function useLocationState(): [\n  LocationState,\n  (s: LocationState) => void\n] {\n  const [state, setState] = useState(getLocationState);\n\n  useEffect(() => {\n    const listener = () => setState(getLocationState());\n    window.addEventListener(\"popstate\", listener);\n    return () => window.removeEventListener(\"popstate\", listener);\n  }, []);\n\n  useEffect(() => {\n    const listener: Listener = (newState) => setState(newState);\n    listeners.push(listener);\n\n    return () => {\n      listeners.splice(listeners.indexOf(listener), 1);\n    };\n  }, []);\n\n  const updateLocationState = useCallback((newState: LocationState) => {\n    const searchParams = new URLSearchParams();\n    searchParams.set(\"world\", newState.world.slug);\n    if (newState.route) {\n      searchParams.set(\"route\", newState.route.slug);\n    }\n\n    window.history.pushState(undefined, \"\", `?${searchParams.toString()}`);\n    setState(newState);\n    listeners.forEach((l) => l(newState));\n  }, []);\n\n  return [state, updateLocationState];\n}\n\n\nfunction getLocationState(): LocationState {\n  const searchParams = new URLSearchParams(window.location.search);\n\n  const world =\n    worlds.find((w) => w.slug === searchParams.get(\"world\")) ?? DEFAULT_WORLD;\n\n  const route = routes\n    .filter((r) => r.world === world?.slug)\n    .find((r) => r.slug === searchParams.get(\"route\"));\n\n  return { world, route };\n}\n","import { useCallback, useEffect, useState } from \"react\";\nimport { Settings } from \"../types\";\n\nconst LOCAL_STORAGE_KEY = \"settings\";\n\ntype Listener = (settings: Settings) => void;\nconst listeners: Listener[] = [];\n\nfunction loadSettings(): Settings {\n  try {\n    const rawSettings = localStorage.getItem(LOCAL_STORAGE_KEY) ?? \"{}\";\n    const settings: Partial<Settings> = JSON.parse(rawSettings);\n\n    return {\n      sport: settings.sport ?? \"cycling\",\n    };\n  } catch {\n    return {\n      sport: \"cycling\",\n    };\n  }\n}\n\nfunction saveSettings(settings: Settings) {\n  localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(settings));\n}\n\nexport function useSettings(): [Settings, (settings: Settings) => void] {\n  const [settings, setSettings] = useState(loadSettings);\n\n  useEffect(() => {\n    const listener: Listener = (newSettings) => setSettings(newSettings);\n    listeners.push(listener);\n\n    return () => {\n      listeners.splice(listeners.indexOf(listener), 1);\n    };\n  }, [settings]);\n\n  const updateSettings = useCallback((newSettings: Settings) => {\n    setSettings(newSettings);\n    saveSettings(newSettings);\n    listeners.forEach((listener) => listener(newSettings));\n  }, []);\n\n  return [settings, updateSettings];\n}\n","import { routes, worlds } from \"../data\";\nimport { Route, Segment, Sport, World } from \"../types\";\n\nexport type SearchResult =\n  | SearchResultWorld\n  | SearchResultRoute\n  | SearchResultSegment;\n\nexport interface SearchResultWorld {\n  type: \"world\";\n  terms: string[];\n  data: World;\n}\n\nexport interface SearchResultRoute {\n  type: \"route\";\n  terms: string[];\n  data: Route;\n}\n\nexport interface SearchResultSegment {\n  type: \"segment\";\n  terms: string[];\n  data: Segment;\n}\n\nconst searchResults: SearchResult[] = [\n  ...worlds.map((world) => ({\n    type: \"world\" as const,\n    terms: [world.name].map((t) => t.toLocaleLowerCase()),\n    data: world,\n  })),\n  ...routes\n    .filter((route) => route.stravaSegmentId !== undefined)\n    .map((route) => ({\n      type: \"route\" as const,\n      terms: [\n        worlds.find((w) => w.slug === route.world)!.name,\n        route.name,\n      ].map((t) => t.toLocaleLowerCase()),\n      data: route,\n    })),\n  //   ...segments\n  //     .filter((route) => route.stravaSegmentId !== undefined)\n  //     .map((segment) => ({\n  //     type: \"segment\" as const,\n  //     terms: [\n  //       worlds.find((w) => w.slug === segment.slug)!.name,\n  //       segment.name,\n  //     ].map((t) => t.toLocaleLowerCase()),\n  //     data: segment,\n  //   })),\n];\n\nexport function search(term: string, sport: Sport): SearchResult[] {\n  const terms = term\n    .toLocaleLowerCase()\n    .split(\" \")\n    .filter((t) => t.length > 0);\n\n  return searchResults\n    .filter((sr) => {\n      if (sr.type === \"world\") {\n        return true;\n      } else {\n        return sr.data.sport === sport;\n      }\n    })\n\n    .filter((sr) =>\n      terms.every((t) => sr.terms.some((srt) => srt.includes(t)))\n    );\n}\n\nexport const searchResultTypes = {\n  world: {\n    title: \"Worlds\",\n  },\n  route: {\n    title: \"Routes\",\n  },\n  segment: {\n    title: \"Segments\",\n  },\n};\n","import { Button } from \"@react-md/button\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@react-md/dialog\";\nimport { Fieldset, Radio } from \"@react-md/form\";\nimport React, { ChangeEvent } from \"react\";\nimport { useSettings } from \"../../hooks/useSettings\";\nimport { Sport } from \"../../types\";\n\ninterface Props {\n  visible: boolean;\n  onClose: () => void;\n}\n\nexport function SettingsDialog({ visible, onClose }: Props) {\n  const [settings, setSettings] = useSettings();\n\n  const handleSportChange = (e: ChangeEvent<HTMLInputElement>) => {\n    if (e.target.checked) {\n      setSettings({ ...settings, sport: e.target.value as Sport });\n    }\n  };\n  return (\n    <Dialog\n      id=\"settings-dialog\"\n      aria-labelledby=\"settings-dialog-title\"\n      visible={visible}\n      onRequestClose={onClose}\n    >\n      <DialogHeader>\n        <DialogTitle id=\"settings-dialog-title\">Settings</DialogTitle>\n      </DialogHeader>\n      <DialogContent>\n        <Fieldset legend=\"Sport\">\n          <Radio\n            id=\"settings-dialog-cycling\"\n            name=\"settings-dialog-sport\"\n            label=\"Cycling\"\n            value=\"cycling\"\n            checked={settings.sport === \"cycling\"}\n            onChange={handleSportChange}\n          />\n          <Radio\n            id=\"settings-dialog-running\"\n            name=\"settings-dialog-sport\"\n            label=\"Running\"\n            value=\"running\"\n            checked={settings.sport === \"running\"}\n            onChange={handleSportChange}\n          />\n        </Fieldset>\n      </DialogContent>\n      <DialogFooter>\n        <Button id=\"dialog-close\" onClick={onClose}>\n          Close\n        </Button>\n      </DialogFooter>\n    </Dialog>\n  );\n}\n","import { StravaSegment } from \"./types\";\n\nconst cache: { [cacheKey: string]: Promise<any> } = {};\n\nexport async function getStravaSegment(\n  segmentSlug: string\n): Promise<StravaSegment> {\n  if (!cache[segmentSlug]) {\n    cache[segmentSlug] = fetchStravaSegment(segmentSlug);\n  }\n\n  return await cache[segmentSlug];\n}\n\nexport async function getStravaSegmentStream<\n  Stream extends \"altitude\" | \"distance\" | \"latlng\"\n>(segmentSlug: string, stream: Stream): Promise<StravaSegment[Stream]> {\n  const cacheKey = `${segmentSlug}-${stream}`;\n  if (!cache[cacheKey]) {\n    cache[cacheKey] = fetchStravaSegmentStream(segmentSlug, stream);\n  }\n\n  return cache[cacheKey];\n}\n\nexport async function getStravaSegmentStreams<\n  Stream extends \"altitude\" | \"distance\" | \"latlng\"\n>(\n  segmentSlug: string,\n  streams: ReadonlyArray<Stream>\n): Promise<Pick<StravaSegment, Stream>> {\n  const streamData = await Promise.all(\n    streams.map((stream) => getStravaSegmentStream(segmentSlug, stream))\n  );\n\n  // @ts-ignore\n  return Object.fromEntries(\n    streams.map((stream, i) => [stream, streamData[i]])\n  );\n}\n\nasync function fetchStravaSegment(segmentSlug: string) {\n  const response = await Promise.all([\n    getStravaSegmentStream(segmentSlug, \"altitude\"),\n    getStravaSegmentStream(segmentSlug, \"distance\"),\n    getStravaSegmentStream(segmentSlug, \"latlng\"),\n  ]);\n\n  return {\n    altitude: response[0],\n    distance: response[1],\n    latlng: response[2],\n  };\n}\n\nasync function fetchStravaSegmentStream<\n  Stream extends \"altitude\" | \"distance\" | \"latlng\"\n>(segmentSlug: string, stream: Stream): Promise<StravaSegment[Stream]> {\n  const response = await fetch(`segments/${segmentSlug}/${stream}.json`);\n  return await response.json();\n}\n","export function ElevationGradient() {\n  return (\n    <linearGradient id=\"colorElevation\"  x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n      <stop offset=\"5%\" stopColor=\"black\" stopOpacity={0.8} />\n      <stop offset=\"95%\" stopColor=\"black\" stopOpacity={0} />\n    </linearGradient>\n  );\n}\n","import { CircularProgress } from \"@react-md/progress\";\nimport uniqWith from \"lodash/uniqWith\";\nimport React, { useMemo } from \"react\";\nimport { useAsync } from \"react-async-hook\";\nimport { Area, AreaChart, XAxis, YAxis } from \"recharts\";\nimport { getStravaSegmentStreams } from \"../../StravaSegmentRepository\";\nimport { Route, StravaSegment } from \"../../types\";\nimport { ElevationGradient } from \"../ElevationGradient\";\n\ninterface Props {\n  route: Route;\n}\n\nconst REQUIRED_STREAMS = [\"altitude\", \"distance\"];\n\nexport function ElevationChartPreview({ route }: Props) {\n  const { result: segment } = useAsync<\n    Pick<StravaSegment, \"altitude\" | \"distance\">\n  >(getStravaSegmentStreams, [route.slug, REQUIRED_STREAMS]);\n\n  const data: any[] | undefined = useMemo(() => {\n    if (segment === undefined) {\n      return;\n    }\n\n    const filteredData = uniqWith(\n      segment.distance.map((distance, index) => ({\n        distance: Math.round(distance / 100) / 10,\n        elevation: segment.altitude[index],\n      })),\n      (a, b) => a.distance === b.distance\n    );\n\n    // remove negative elevation\n    const lowestElevation = Math.min(...filteredData.map((d) => d.elevation));\n    return filteredData.map((d) => ({\n      ...d,\n      elevation: d.elevation - lowestElevation,\n    }));\n  }, [segment]);\n\n  if (!data) {\n    return (\n      <CircularProgress\n        id={`elevation-preview-${route.slug}`}\n        small\n        circleStyle={{ stroke: \"black\" }}\n      />\n    );\n  }\n\n  return (\n    <AreaChart\n      height={50}\n      width={100}\n      data={data}\n      // @ts-ignore\n      baseValue=\"dataMin\"\n    >\n      <defs>\n        <ElevationGradient />\n      </defs>\n\n      <XAxis\n        dataKey=\"distance\"\n        type=\"number\"\n        domain={[0, \"dataMax\"]}\n        unit=\"km\"\n        hide={true}\n      />\n\n      <YAxis\n        dataKey=\"elevation\"\n        type=\"number\"\n        allowDecimals={false}\n        domain={[0, 750]}\n        unit=\"m\"\n        hide={true}\n      />\n\n      <Area\n        type=\"monotone\"\n        dataKey=\"elevation\"\n        name=\"Elevation\"\n        stroke=\"black\"\n        fillOpacity={1}\n        fill=\"url(#colorElevation)\"\n        unit=\"m\"\n        isAnimationActive={false}\n      />\n    </AreaChart>\n  );\n}\n","import { ListItem } from \"@react-md/list\";\nimport React, { useRef } from \"react\";\nimport { useOnScreen } from \"../../hooks/useOnScreen\";\nimport { Route } from \"../../types\";\nimport { ElevationChartPreview } from \"../ElevationChartPreview\";\n\nexport interface Props {\n  route: Route;\n  onClick: () => void;\n}\n\nexport function SearchResultCardRoute({ route, onClick }: Props) {\n  return (\n    <ListItem\n      secondaryText={getRouteInfo(route)}\n      onClick={onClick}\n      rightAddonType=\"large-media\"\n      rightAddon={<ChartContainer route={route} />}\n    >\n      {route.name}\n    </ListItem>\n  );\n}\n\nfunction getRouteInfo(route: Route) {\n  return `${route.distance}km | ${route.elevation}m`;\n}\n\ninterface ChartProps {\n  route: Route;\n}\n\nfunction ChartContainer({ route }: ChartProps) {\n  const ref = useRef<HTMLDivElement | null>(null);\n\n  const onScreen = useOnScreen(ref);\n\n  return (\n    <div ref={ref} style={{ width: \"100%\", pointerEvents: \"none\" }}>\n      {onScreen ? <ElevationChartPreview route={route} /> : null}\n    </div>\n  );\n}\n","import { MutableRefObject, useEffect, useState } from \"react\";\n\n/**\n * @see https://usehooks.com/useOnScreen/\n */\nexport function useOnScreen(ref: MutableRefObject<HTMLElement | null>) {\n  const [isIntersecting, setIntersecting] = useState(false);\n  useEffect(() => {\n    const current = ref.current;\n\n    const observer = new IntersectionObserver(([entry]) => {\n      setIntersecting(entry.isIntersecting);\n    });\n    if (current) {\n      observer.observe(current);\n    }\n    return () => {\n      if (current) {\n        observer.unobserve(current);\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  return isIntersecting;\n}\n","import { ListItem } from \"@react-md/list\";\nimport { routes, segments } from \"../../data\";\nimport { useSettings } from \"../../hooks/useSettings\";\nimport { World } from \"../../types\";\n\nexport interface Props {\n  world: World;\n  onClick: () => void;\n}\n\nexport function SearchResultCardWorld({ world, onClick }: Props) {\n  const [settings] = useSettings();\n  const secondaryText = `${\n    routes\n      .filter((r) => r.sport === settings.sport)\n      .filter((r) => r.world === world.slug).length\n  } routes | ${\n    segments\n      .filter((s) => s.sport === settings.sport)\n      .filter((s) => s.world === world.slug).length\n  } segments`;\n\n  return (\n    <ListItem secondaryText={secondaryText} onClick={onClick}>\n      {world.name}\n    </ListItem>\n  );\n}\n","import { Divider } from \"@react-md/divider\";\nimport { ListSubheader } from \"@react-md/list\";\nimport React, { Fragment } from \"react\";\nimport { SearchResult, searchResultTypes } from \"../../services/search\";\nimport { SearchResultCardRoute } from \"./SearchResultCardRoute\";\nimport { SearchResultCardWorld } from \"./SearchResultCardWorld\";\n\ninterface Props {\n  searchResults: ReadonlyArray<SearchResult>;\n  onResultClick: (searchResult: SearchResult) => void;\n}\n\nexport function SearchResultList({ searchResults, onResultClick }: Props) {\n  return (\n    <>\n      {searchResults.map((searchResult, i) => (\n        <Fragment key={searchResult.data.slug}>\n          {searchResults[i - 1]?.type !== searchResult.type && (\n            <>\n              {searchResults[i - 1] && <Divider />}\n              <ListSubheader>\n                {searchResultTypes[searchResult.type].title}\n              </ListSubheader>\n            </>\n          )}\n          <SearchResultCard\n            searchResult={searchResult}\n            onClick={() => onResultClick(searchResult)}\n          />\n        </Fragment>\n      ))}\n    </>\n  );\n}\n\ninterface SearchResultCardProps {\n  searchResult: SearchResult;\n  onClick: () => void;\n}\n\nfunction SearchResultCard({ searchResult, onClick }: SearchResultCardProps) {\n  switch (searchResult.type) {\n    case \"world\":\n      return (\n        <SearchResultCardWorld world={searchResult.data} onClick={onClick} />\n      );\n    case \"route\":\n      return (\n        <SearchResultCardRoute route={searchResult.data} onClick={onClick} />\n      );\n    default:\n      return null;\n  }\n}\n","import { Button } from \"@react-md/button\";\nimport { Divider } from \"@react-md/divider\";\nimport { TextField } from \"@react-md/form\";\nimport { FontIcon } from \"@react-md/icon\";\nimport { List, ListItem, SimpleListItem } from \"@react-md/list\";\nimport React, { useState } from \"react\";\nimport { routes, worlds } from \"../../data\";\nimport { useLocationState } from \"../../hooks/useLocationState\";\nimport { useSettings } from \"../../hooks/useSettings\";\nimport { search, SearchResult } from \"../../services/search\";\nimport { SettingsDialog } from \"../SettingsDialog\";\nimport styles from \"./index.module.css\";\nimport { SearchResultCardRoute } from \"./SearchResultCardRoute\";\nimport { SearchResultList } from \"./SearchResultList\";\n\nexport function Sidebar() {\n  const [locationState, setLocationState] = useLocationState();\n  const [query, setQuery] = useState(\"\");\n  const [settings] = useSettings();\n\n  const [settingsDialogVisible, setSettingsDialogVisible] = useState(false);\n\n  const searchResults = search(query, settings.sport);\n\n  const handleSearchResultClick = (searchResult: SearchResult) => {\n    switch (searchResult.type) {\n      case \"world\":\n        setLocationState({ world: searchResult.data });\n        break;\n      case \"route\":\n        setLocationState({\n          world: worlds.find((w) => w.slug === searchResult.data.world)!,\n          route: searchResult.data,\n        });\n        break;\n    }\n  };\n\n  return (\n    <>\n      <div className={styles.Container}>\n        <List style={{ width: \"100%\" }} className={styles.SearchBox}>\n          <SimpleListItem>\n            <TextField\n              id=\"search-input\"\n              style={{ width: \"100%\" }}\n              placeholder={locationState.world.name}\n              value={query}\n              onChange={(e) => setQuery(e.target.value)}\n              isRightAddon={false}\n              rightChildren={\n                query !== \"\" && (\n                  <Button\n                    buttonType=\"icon\"\n                    style={{ right: 0, position: \"absolute\" }}\n                    onClick={() => setQuery(\"\")}\n                    aria-label=\"Clear search field\"\n                  >\n                    <FontIcon>clear</FontIcon>\n                  </Button>\n                )\n              }\n            />\n          </SimpleListItem>\n          <Divider className={styles.NoGapDivider} />\n        </List>\n        <List className={styles.List}>\n          {query === \"\" ? (\n            <>\n              {routes\n                .filter((route) => route.world === locationState.world.slug)\n                .filter((route) => route.sport === settings.sport)\n                .filter((route) => route.stravaSegmentId !== undefined)\n                .sort((a, b) => a.name.localeCompare(b.name))\n                .map((route) => (\n                  <SearchResultCardRoute\n                    route={route}\n                    key={route.slug}\n                    onClick={() =>\n                      setLocationState({\n                        world: worlds.find((w) => w.slug === route.world)!,\n                        route,\n                      })\n                    }\n                  />\n                ))}\n            </>\n          ) : (\n            <SearchResultList\n              searchResults={searchResults}\n              onResultClick={handleSearchResultClick}\n            />\n          )}\n        </List>\n        <List className={styles.BottomMenu}>\n          <Divider className={styles.NoGapDivider} />\n          <ListItem onClick={() => setSettingsDialogVisible(true)}>\n            Settings\n          </ListItem>\n        </List>\n      </div>\n      <SettingsDialog\n        visible={settingsDialogVisible}\n        onClose={() => setSettingsDialogVisible(false)}\n      />\n    </>\n  );\n}\n","import { LatLngTuple } from \"leaflet\";\nimport critCityMap from \"./maps/crit-city.png\";\nimport franceMap from \"./maps/france.png\";\nimport innsbruckMap from \"./maps/innsbruck.png\";\nimport londonMap from \"./maps/london.png\";\nimport newYorkMap from \"./maps/new-york.png\";\nimport parisMap from \"./maps/paris.png\";\nimport richmondMap from \"./maps/richmond.png\";\nimport watopiaMap from \"./maps/watopia.png\";\nimport yorkshireMap from \"./maps/yorkshire.png\";\nimport { WorldSlug } from \"./types\";\n\nexport type WorldConfig = {\n  imageBounds: [LatLngTuple, LatLngTuple];\n  initialBounds: [LatLngTuple, LatLngTuple];\n  image: string;\n  backgroundColor: string;\n};\n\nexport const worldConfigs: Record<WorldSlug, WorldConfig> = {\n  \"crit-city\": {\n    imageBounds: [\n      [-10.3657, 165.7824],\n      [-10.4038, 165.8207],\n    ],\n    initialBounds: [\n      [-10.382352, 165.798758],\n      [-10.386016, 165.803496],\n    ],\n    image: critCityMap,\n    backgroundColor: \"#7c9938\",\n  },\n  france: {\n    imageBounds: [\n      [-21.64155, 166.1384],\n      [-21.7564, 166.26125],\n    ],\n    initialBounds: [\n      [-21.697812, 166.148225],\n      [-21.744906, 166.202642],\n    ],\n    image: franceMap,\n    backgroundColor: \"#6f992d\",\n  },\n  innsbruck: {\n    imageBounds: [\n      [47.2947, 11.3501],\n      [47.2055, 11.4822],\n    ],\n    initialBounds: [\n      [47.280902, 11.386414],\n      [47.214544, 11.445934],\n    ],\n    image: innsbruckMap,\n    backgroundColor: \"#7c9938\",\n  },\n  london: {\n    imageBounds: [\n      [51.5362, -0.1776],\n      [51.4601, -0.0555],\n    ],\n    initialBounds: [\n      [51.511261, -0.134875],\n      [51.489256, -0.072996],\n    ],\n    image: londonMap,\n    backgroundColor: \"#6f992d\",\n  },\n  \"new-york\": {\n    imageBounds: [\n      [40.81725, -74.0227],\n      [40.74085, -73.9222],\n    ],\n    initialBounds: [\n      [40.799618, -73.982068],\n      [40.763547, -73.949602],\n    ],\n    image: newYorkMap,\n    backgroundColor: \"#bbbbb7\",\n  },\n  paris: {\n    imageBounds: [\n      [48.9058, 2.2561],\n      [48.82945, 2.3722],\n    ],\n    initialBounds: [\n      [48.874328, 2.294207],\n      [48.860895, 2.331992],\n    ],\n    image: parisMap,\n    backgroundColor: \"#b9b9b9\",\n  },\n  richmond: {\n    imageBounds: [\n      [37.5774, -77.48954],\n      [37.5014, -77.394],\n    ],\n    initialBounds: [\n      [37.558393, -77.467668],\n      [37.520429, -77.415864],\n    ],\n    image: richmondMap,\n    backgroundColor: \"#7c9938\",\n  },\n  watopia: {\n    imageBounds: [\n      [-11.62597, 166.87747],\n      [-11.70255, 167.03255],\n    ],\n    initialBounds: [\n      [-11.635444, 166.93555],\n      [-11.673613, 166.972511],\n    ],\n    image: watopiaMap,\n    backgroundColor: \"#0884e2\",\n  },\n  yorkshire: {\n    imageBounds: [\n      [54.0254, -1.632],\n      [53.9491, -1.5022],\n    ],\n    initialBounds: [\n      [53.999691, -1.592961],\n      [53.974875, -1.539474],\n    ],\n    image: yorkshireMap,\n    backgroundColor: \"#7c9938\",\n  },\n};\n","export default __webpack_public_path__ + \"static/media/crit-city.3bab2d0f.png\";","export default __webpack_public_path__ + \"static/media/france.aded90ff.png\";","export default __webpack_public_path__ + \"static/media/innsbruck.9821ed90.png\";","export default __webpack_public_path__ + \"static/media/london.54ae112e.png\";","export default __webpack_public_path__ + \"static/media/new-york.5bf9b5e8.png\";","export default __webpack_public_path__ + \"static/media/paris.d1eaa520.png\";","export default __webpack_public_path__ + \"static/media/richmond.72df812b.png\";","export default __webpack_public_path__ + \"static/media/watopia.0901a23e.png\";","export default __webpack_public_path__ + \"static/media/yorkshire.b83235cf.png\";","import { LatLngBounds, LatLngExpression, Map } from \"leaflet\";\nimport \"leaflet/dist/leaflet.css\";\nimport React, { useEffect, useMemo, useState } from \"react\";\nimport { useAsync } from \"react-async-hook\";\nimport {\n  Circle,\n  ImageOverlay,\n  LayerGroup,\n  LayersControl,\n  MapContainer,\n  Pane,\n  Polyline,\n  ScaleControl,\n} from \"react-leaflet\";\nimport { segments } from \"./data\";\nimport { useLocationState } from \"./hooks/useLocationState\";\nimport { useSettings } from \"./hooks/useSettings\";\nimport {\n  getStravaSegmentStream,\n  getStravaSegmentStreams,\n} from \"./StravaSegmentRepository\";\nimport { Route, Segment } from \"./types\";\nimport { worldConfigs } from \"./worldConfig\";\n\ninterface Props {\n  mouseHoverDistance: number | undefined;\n}\n\nexport default function RouteMap({ mouseHoverDistance }: Props) {\n  const [locationState] = useLocationState();\n  const world = locationState.world;\n  const worldConfig = worldConfigs[world.slug];\n  const [settings] = useSettings();\n\n  const filteredSegments = useMemo(\n    () =>\n      segments\n        .filter((s) => s.sport === settings.sport)\n        .filter((s) => s.world === world.slug)\n        .filter((s) => s.stravaSegmentId !== undefined),\n    [settings.sport, world]\n  );\n  const { result: stravaSegmentsInWorld } = useAsync(\n    async (fs: Segment[]) => {\n      const stravaSegments = await Promise.all(\n        fs.map((s) => getStravaSegmentStream(s.slug, \"latlng\"))\n      );\n      return fs.map((s, i) => ({\n        ...s,\n        stravaData: stravaSegments[i],\n      }));\n    },\n    [filteredSegments]\n  );\n\n  const [map, setMap] = useState<Map | undefined>();\n  useEffect(() => {\n    map?.zoomControl.setPosition(\"topright\");\n  }, [map]);\n\n  const { result: routeStravaSegment } = useAsync(\n    async (r?: Route) => {\n      if (r === undefined) {\n        return;\n      }\n\n      return await getStravaSegmentStreams(r.slug, [\"distance\", \"latlng\"]);\n    },\n    [locationState.route]\n  );\n\n  useEffect(() => {\n    if (!map || !routeStravaSegment) {\n      return;\n    }\n\n    const bounds = routeStravaSegment.latlng.reduce(\n      (bounds, coord) => bounds.extend(coord),\n      new LatLngBounds(\n        routeStravaSegment.latlng[0],\n        routeStravaSegment.latlng[0]\n      )\n    );\n\n    map.invalidateSize();\n    map.fitBounds(bounds);\n  }, [map, routeStravaSegment, worldConfig]);\n\n  useEffect(() => {\n    if (!map || !locationState) {\n      return;\n    }\n\n    const worldConfig = worldConfigs[locationState.world.slug];\n\n    map.invalidateSize();\n    map.setMaxBounds(worldConfig.imageBounds);\n\n    const minZoom = map.getBoundsZoom(worldConfig.imageBounds, false);\n    map.setMinZoom(minZoom);\n\n    if (!locationState.route) {\n      map.fitBounds(worldConfig.initialBounds);\n    }\n  }, [map, locationState]);\n\n  const pointCoordinates = useMemo<LatLngExpression | undefined>(() => {\n    if (!routeStravaSegment || !mouseHoverDistance) {\n      return;\n    }\n\n    const pointIndex = routeStravaSegment.distance.findIndex(\n      (d) => d > mouseHoverDistance\n    );\n    if (!pointIndex) {\n      return;\n    }\n    return routeStravaSegment.latlng[pointIndex];\n  }, [routeStravaSegment, mouseHoverDistance]);\n\n  return (\n    <MapContainer\n      key={locationState.world.slug}\n      whenCreated={(map) => setMap(map)}\n      bounds={worldConfig.imageBounds}\n      style={{ backgroundColor: worldConfig.backgroundColor }}\n      maxZoom={19}\n    >\n      <ImageOverlay\n        url={worldConfig.image}\n        bounds={worldConfig.imageBounds}\n        attribution='&amp;copy <a href=\"https://zwift.com\" rel=\"noreferrer noopener\">Zwift</a>'\n      />\n\n      <Pane name=\"route\">\n        {routeStravaSegment && (\n          <Polyline\n            positions={routeStravaSegment.latlng}\n            pathOptions={{ color: \"#fc6719\", weight: 5 }}\n          />\n        )}\n      </Pane>\n\n      <LayersControl>\n        <LayersControl.Overlay name=\"Show segments\" checked>\n          <LayerGroup>\n            <Pane name=\"segments\">\n              {stravaSegmentsInWorld?.map((s) => (\n                <Polyline\n                  key={s.slug}\n                  positions={s.stravaData}\n                  pathOptions={{ color: \"green\", weight: 5 }}\n                />\n              ))}\n            </Pane>\n          </LayerGroup>\n        </LayersControl.Overlay>\n      </LayersControl>\n\n      <Pane name=\"mouse-position\">\n        {pointCoordinates && (\n          <Circle\n            center={pointCoordinates}\n            radius={10}\n            pathOptions={{\n              color: \"black\",\n              fillColor: \"black\",\n              fillOpacity: 1,\n            }}\n          />\n        )}\n      </Pane>\n\n      <ScaleControl position=\"topright\" />\n    </MapContainer>\n  );\n}\n","import React, { useState } from \"react\";\nimport styles from \"./App.module.css\";\nimport { Sidebar } from \"./components/Sidebar\";\nimport RouteMap from \"./RouteMap\";\n\nexport default function App() {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const [mouseHoverDistance, _setMouseHoverDistance] = useState<\n    number | undefined\n  >(undefined);\n\n  return (\n    <>\n      <div className={styles.Wrapper}>\n        <Sidebar />\n        <RouteMap mouseHoverDistance={mouseHoverDistance} />\n      </div>\n    </>\n  );\n}\n","import \"./index.scss\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport \"./index.css\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"app\")\n);\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Container\":\"Sidebar_Container__35ytb\",\"SearchBox\":\"Sidebar_SearchBox__3g5oO\",\"List\":\"Sidebar_List__2trxD\",\"BottomMenu\":\"Sidebar_BottomMenu__1yb_8\",\"NoGapDivider\":\"Sidebar_NoGapDivider__2LMcS\"};"],"sourceRoot":""}